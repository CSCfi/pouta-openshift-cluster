# Namespace label admission controller

## Background

An admission controller intercepts API calls prior to their persistence, and after
the request is authenticated and authorized.

If multiple admission controllers exist, they will be ran in sequence.
If any of the admission controllers rejects the request, the entire request is rejected
immediately, and an error is returned to the end-user.

## What it is

This a namespace admission controller which validates the self-provisioned namespaces in
Openshift. First it makes sure that the user has the correct access rights, and labels the
namespace Openshift object accordingly.

The deployment playbook is under: *playbooks/deploy_ns_project_label_webhook.yml*

## How to enable it

This particular controller eequires two feature flags to be set:

* **enable_openshift_admission_webhooks: true** -> This will enable the Mutating and
Validating Admission webhooks APIs of Openshift as they are disabled by default.
* **deploy_ns_project_label_webhook: true** -> This feature flag will enable and deploy the
namespace label admission controller into the cluster.

## Pre-requisites

* The controller's docker image which contains the code: **ns_project_webhook_image**
* CA Bundle (Automatically generated by the playbook): **ca_bundle**
* LDAP credentials:
  * Protocol: **ldap_protocol**
  * Server endpoint: **ldap_auth_host**
  * Username and password:
    * **ldap_bind_account_dn**
    * **ldap_bind_account_password**
  * Projects and users tree bases:
    * **ldap_user_base**
    * **ldap_project_base**
* Users whitelist: is a user list which contains users from whom the namespace requests
will be directly approved, without having to go through the review. This list should be set
in the **ns_project_webhook_users_whitelist** variable.
Example on how to use:
  * ns_project_webhook_users_whitelist: "system:admin,user1,user2"

### Optional settings

* Verbose mode: can be enabled by setting **ns_project_webhook_verbose: 1**, it is
disabled by default. When enabled, the controller prints the admission review requests as
part of the logs.

